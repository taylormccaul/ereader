<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Comfortaa|Kanit|Montserrat|Open+Sans|Open+Sans+Condensed:300|Roboto+Condensed|Sen&display=swap" rel="stylesheet"> 
    <title>E-reader</title>
    <style>
        label {
            font-family: 'Roboto Condensed', sans-serif;
            display: block;
            margin: 0.5em 0em;
        }

        input {
            padding: 5px;
            min-width: 20vw;
        }

        textarea {
            min-width: 20vw;
            min-height: 55vh;
        }

        select {
            padding: 5px;
            min-width: 20vw;
        }

        #finish {
            display: block;
            min-width: 20vw;
            margin: 1em 0em;
            padding: 5px;
        }

        .view {
            float: right;
            max-width: 76vw;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="view">
        <h1 id="title"></h1>
        <p id="text"></p>
    </div>
    <div class="input-form">
        <label for="title-input">Title</label>
        <input type="text" name="title-input" id="title-input">

        <!--<label for="chapter-input">Number of Chapters</label>
        <input type="text" name="chapter-input" id="chapter-input">-->
        
        <label for="text-input" id="text-label">Book Text</label>
        <textarea name="text-input" id="text-input"></textarea>

        <label for="font-options">Font</label>
        <select id="font-options">
            <option value="times" selected>Times New Roman</option>
            <option value="mont">Montserrat</option>
            <option value="hel">Helvetica</option>
            <option value="arial">Arial</option>
            <option value="jose">Josefin Sans</option>
            <option value="open">Open Sans</option>
            <option value="com">Comfortaa</option>
        </select>

        <label for="line-height">Line Height</label>
        <input type="range" min="1" max="5" step="0.5" value="1" id="line-height">

        <button type="submit" name="finish" id="finish">Done</button>
    </div>
    <script>
        var titleInput = document.getElementById("title-input");
        var textInput = document.getElementById("text-input");

        var title = document.getElementById("title");
        var text = document.getElementById("text");

        var select = document.getElementById("font-options");
        var options = document.querySelector("option");

        var range = document.getElementById("line-height");

        select.value = "times";

        titleInput.addEventListener("input", () => {
            title.innerHTML = titleInput.value;
        });

        textInput.addEventListener("input", () => {
            text.innerHTML = textInput.value;

            function replaceRange(s, start, end, substitute) {
                return s.substring(0, start) + substitute + s.substring(end);
            }

            var pos = textInput.value.indexOf("Chapter");
            var br = textInput.value.indexOf("\n\n");
            var brNumber = (textInput.value.charAt(br+3));
            var number = 1;//(textInput.value.charAt(pos+8));
            var brPos = [];
            var res;
            text.innerHTML = "";

            var result = "";

            //text.innerHTML += replaceRange(`Chapter ${number}`, 0, 9, `<br><h2>Chapter ${number}</h2><br>`);

            while (pos > -1) {
                /*res = replaceRange(`Chapter ${number}`, 0, 9, `<br><h2>Chapter ${number}</h2><br>`);
                text.innerHTML += res;
                text.innerHTML += textInput.value.slice(pos+9, textInput.value.indexOf("Chapter", pos+1));
                //br = textInput.value.indexOf("\n\n", br+1);*/
                pos = textInput.value.indexOf("Chapter", pos+1);//(parseInt(number) + 1).toString();
                //brNumber = (parseInt(brNumber) + 1).toString();
                //console.log(textInput.value.slice(br+3, textInput.value.indexOf("\n\n", br+1)));
            }

            while (br > -1) {
                //res = replaceRange("\n\n", br, br+1, `Gekko`);
                //text.innerHTML += res;
                //text.innerHTML += textInput.value.slice(br, textInput.value.indexOf("\n\n", br+1));
                //brPos.push(br);
                    if (textInput.value.slice(prevBr, br).includes("Chapter")) {
                        result += replaceRange(`Chapter ${number}`, 0, 9, `<br><h2>Chapter ${number}</h2><br>`);
                        //console.log(textInput.value.slice(prevBr - 5, br))
                        //result += chap;
                        number += 1;
                    }
                    var prevBr = br;
                    br = textInput.value.indexOf("\n\n", br+1);
                    //console.log(textInput.value.slice(prevBr, br));
                    result += "<br>" + textInput.value.slice(prevBr, br) + "<br>";
                    brNumber = (parseInt(number) + 1).toString();
                }

            text.innerHTML += result;

            //console.log(brPos);

            //var result = "";

            /*for (let i = 0; i < textInput.value.length; i++) {
                if (text.innerHTML.indexOf("\n\n") == i) {
                    console.log("HI");
                }
            }*/
            //console.log(text.innerHTML)

            //for (let i = 0; i < Math.floor(brPos.length / 10); i++) {
                //console.log(textInput.value.charAt(i));
                //console.log(textInput.value.charAt(brPos[i]));
                ///console.log(text.innerHTML.charAt(brPos[i]));
                //console.log(`${text.innerHTML.substring(0, brPos[i])}<br><br>${text.innerHTML.substring(brPos[i])}`);
            //}

            //text.innerHTML = result;

            //textInput.value.replace(/\r\n/, "br");
            //console.log(textInput.value);
        });

        range.addEventListener("input", () => {
            text.style.lineHeight = range.value;
        });

        //include options for line height, letter spacing

        select.addEventListener("input", () => {
            console.log(select.value);
            switch(select.value) {
                case "mont":
                    text.style.fontFamily = "Montserrat";
                break;
            }
        });

    </script>
</body>
</html>
