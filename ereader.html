<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Comfortaa|Kanit|Montserrat|Open+Sans|Open+Sans+Condensed:300|Roboto+Condensed|Sen&display=swap" rel="stylesheet"> 
    <title>E-reader</title>
    <style>
        label {
            font-family: 'Roboto Condensed', sans-serif;
            display: block;
            margin: 0.5em 0em;
        }

        input {
            padding: 5px;
            min-width: 20vw;
        }

        textarea {
            min-width: 20vw;
            min-height: 55vh;
        }

        select {
            padding: 5px;
            min-width: 20vw;
        }

        #finish {
            display: block;
            min-width: 20vw;
            margin: 1em 0em;
            padding: 5px;
        }

        .view {
            float: right;
            max-width: 76vw;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="view">
        <h1 id="title"></h1>
        <p id="text"></p>
    </div>
    <div class="input-form">
        <label for="title-input">Title</label>
        <input type="text" name="title-input" id="title-input">

        <!--<label for="chapter-input">Number of Chapters</label>
        <input type="text" name="chapter-input" id="chapter-input">-->
        
        <label for="text-input" id="text-label">Book Text</label>
        <textarea name="text-input" id="text-input"></textarea>

        <label for="font-options">Font</label>
        <select id="font-options">
            <option value="times" selected>Times New Roman</option>
            <option value="mont">Montserrat</option>
            <option value="hel">Helvetica</option>
            <option value="arial">Arial</option>
            <option value="jose">Josefin Sans</option>
            <option value="open">Open Sans</option>
            <option value="com">Comfortaa</option>
        </select>

        <label for="line-height">Line Height</label>
        <input type="range" min="1" max="5" step="0.5" value="1" id="line-height">

        <button type="submit" name="finish" id="finish">Done</button>
    </div>
    <script>
        var titleInput = document.getElementById("title-input");
        var textInput = document.getElementById("text-input");

        var title = document.getElementById("title");
        var text = document.getElementById("text");

        var select = document.getElementById("font-options");
        var options = document.querySelector("option");

        var range = document.getElementById("line-height");

        select.value = "times";

        titleInput.addEventListener("input", () => {
            title.innerHTML = titleInput.value;
        });

        textInput.addEventListener("input", () => {
            text.innerHTML = textInput.value;

            function replaceRange(s, start, end, substitute) {
                return s.substring(0, start) + substitute + s.substring(end);
            }

            var pos = textInput.value.indexOf("Chapter");
            var br = textInput.value.indexOf("\n\n");
            var brNumber = (textInput.value.charAt(br+3));
            var number = 1;
            var brPos = [];
            var res;
            text.innerHTML = "";

            var result = "";

            while (br > -1) {
                    if (textInput.value.slice(prevBr, br).includes("Chapter")) {
                        result += replaceRange(`Chapter ${number}`, 0, 9, `<br><h2>Chapter ${number}</h2><br>`);
                        number += 1;
                    }
                    var prevBr = br;
                    br = textInput.value.indexOf("\n\n", br+1);
                    if (textInput.value.slice(prevBr, br).includes(`Chapter ${number}`)) {
                        result += "<br>" + textInput.value.slice(prevBr, br-9) + "<br>";
                    } else {
                        result += "<br>" + textInput.value.slice(prevBr, br) + "<br>";
                    }
                }

            text.innerHTML += result;
        });

        range.addEventListener("input", () => {
            text.style.lineHeight = range.value;
        });

        //include options for line height, letter spacing

        select.addEventListener("input", () => {
            console.log(select.value);
            switch(select.value) {
                case "mont":
                    text.style.fontFamily = "Montserrat";
                break;
            }
        });

    </script>
</body>
</html>
